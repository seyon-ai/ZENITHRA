<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenithra ‚Äî shop</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
        }

        /* subtle animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 40%, rgba(198, 167, 94, 0.05) 0%, transparent 40%),
                        radial-gradient(circle at 70% 60%, rgba(198, 167, 94, 0.03) 0%, transparent 50%),
                        #0f0f0f;
            z-index: -2;
            animation: slowDrift 20s infinite alternate ease-in-out;
        }

        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4" viewBox="0 0 4 4"><circle cx="2" cy="2" r="0.5" fill="%23c6a75e" opacity="0.1"/></svg>');
            pointer-events: none;
            z-index: -1;
            opacity: 0.2;
        }

        @keyframes slowDrift {
            0% { transform: scale(1) translate(0%, 0%); }
            100% { transform: scale(1.1) translate(2%, 3%); }
        }

        .container {
            width: 90%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        /* header */
        .site-header {
            padding: 2rem 0 1rem;
            border-bottom: 1px solid rgba(198, 167, 94, 0.2);
            margin-bottom: 2rem;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo-link {
            display: block;
        }

        .logo {
            height: 32px;
            width: auto;
            filter: brightness(0) invert(1) drop-shadow(0 0 2px rgba(198, 167, 94, 0.3));
        }

        .logo-fallback {
            font-size: 1.8rem;
            font-weight: 300;
            letter-spacing: 4px;
            color: #c6a75e;
            text-transform: uppercase;
        }

        .main-nav ul {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-link {
            text-decoration: none;
            color: #aaa;
            font-size: 0.9rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            transition: color 0.2s;
            padding-bottom: 4px;
            border-bottom: 1px solid transparent;
        }

        .nav-link:hover,
        .nav-link.active {
            color: #c6a75e;
            border-bottom-color: #c6a75e;
        }

        /* buttons */
        .btn {
            display: inline-block;
            padding: 0.8rem 2.2rem;
            text-decoration: none;
            font-size: 0.9rem;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            border: 1px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            background: transparent;
            border-radius: 0;
        }

        .btn-gold {
            background-color: #c6a75e;
            color: #0f0f0f;
            border-color: #c6a75e;
        }

        .btn-gold:hover {
            background-color: transparent;
            color: #c6a75e;
            box-shadow: 0 0 12px rgba(198, 167, 94, 0.3);
        }

        /* page header */
        .page-header {
            padding: 2rem 0;
            text-align: center;
        }

        .page-title {
            font-weight: 200;
            letter-spacing: 4px;
            text-transform: uppercase;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
        }

        .gold {
            color: #c6a75e;
        }

        /* product grid */
        .product-grid-section {
            min-height: 50vh;
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin: 2rem 0 4rem;
        }

        @media (min-width: 768px) {
            .product-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 2rem;
            }
        }

        .product-card {
            background-color: #1a1a1a;
            border: 1px solid #2a2a2a;
            padding: 1.5rem 1rem 1rem;
            transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
        }

        .product-card:hover {
            transform: translateY(-6px);
            border-color: #c6a75e;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        .product-card img {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: cover;
            background: #222;
            margin-bottom: 1rem;
        }

        .product-name {
            font-weight: 300;
            font-size: 1rem;
            margin: 0.5rem 0 0.3rem;
            letter-spacing: 0.5px;
        }

        .product-price {
            color: #c6a75e;
            font-size: 1.2rem;
            font-weight: 200;
            margin-top: 0.3rem;
        }

        /* status messages */
        .loading {
            text-align: center;
            padding: 4rem 2rem;
            color: #777;
            font-style: italic;
            grid-column: 1 / -1;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            border: 2px solid #c6a75e;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 3rem;
            color: #c6a75e;
            background: rgba(198, 167, 94, 0.05);
            border: 1px solid rgba(198, 167, 94, 0.2);
            margin: 2rem 0;
            grid-column: 1 / -1;
        }

        .empty-message {
            text-align: center;
            padding: 4rem 2rem;
            color: #777;
            font-style: italic;
            grid-column: 1 / -1;
            background: rgba(255, 255, 255, 0.02);
            border: 1px dashed #333;
        }

        /* footer */
        .site-footer {
            margin-top: auto;
            padding: 3rem 0 2rem;
            border-top: 1px solid rgba(198, 167, 94, 0.1);
            text-align: center;
            font-size: 0.9rem;
            color: #777;
        }

        .footer-contact {
            margin-top: 0.5rem;
            font-size: 0.85rem;
        }

        .footer-contact span {
            color: #c6a75e;
        }

        /* debug info (hidden by default) */
        .debug-info {
            display: none;
            background: #1a1a1a;
            border: 1px solid #c6a75e;
            padding: 1rem;
            margin: 1rem 0;
            color: #e0e0e0;
            font-family: monospace;
            font-size: 0.8rem;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="container header-container">
            <a href="index.html" class="logo-link">
                <img src="logo.png" alt="Zenithra Logo" class="logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <span class="logo-fallback" style="display:none;">Zenithra</span>
            </a>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="shop.html" class="nav-link active">Shop</a></li>
                    <li><a href="contact.html" class="nav-link">Contact</a></li>
                    <li><a href="auth.html" class="nav-link">Login</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container page-header">
            <h1 class="page-title">All <span class="gold">timepieces</span></h1>
            <p style="color: #777; margin-top: 0.5rem;">Swiss craftsmanship ‚Ä¢ Limited editions</p>
        </div>
        
        <section class="container product-grid-section">
            <div id="shop-products" class="product-grid">
                <div class="loading">Loading collection...</div>
            </div>
            
            <!-- Hidden debug panel (only shows if there's an error) -->
            <div id="debug-info" class="debug-info"></div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="container">
            <p>Zenithra ‚Äî since 2025</p>
            <div class="footer-contact">
                <span>üìû +91 8327641735</span> | <span>‚úâÔ∏è contact.Zenithraluxuary@gmail.com</span>
            </div>
            <p style="margin-top:1rem;">¬© Zenithra. All rights reserved.</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC-imAMNL_aWnyRlWIvafELiSWj-IFwyzM",
            authDomain: "zenithra-6b7b6.firebaseapp.com",
            databaseURL: "https://zenithra-6b7b6-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "zenithra-6b7b6",
            storageBucket: "zenithra-6b7b6.firebasestorage.app",
            messagingSenderId: "1014569701920",
            appId: "1:1014569701920:web:ef885db9293718dbc32245"
        };

        // Initialize Firebase
        let app, db;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log('Firebase initialized successfully');
        } catch (initError) {
            console.error('Firebase initialization error:', initError);
            document.getElementById('shop-products').innerHTML = `
                <div class="error-message">
                    Failed to initialize Firebase. Please check your connection.
                </div>
            `;
        }

        const container = document.getElementById('shop-products');
        const debugInfo = document.getElementById('debug-info');

        async function loadProducts() {
            if (!db) {
                container.innerHTML = '<div class="error-message">Database connection failed.</div>';
                return;
            }

            try {
                console.log('Attempting to fetch products from Firestore...');
                
                // Get reference to products collection
                const productsRef = collection(db, 'products');
                
                // Fetch all documents
                const querySnapshot = await getDocs(productsRef);
                
                console.log('Query snapshot received:', {
                    empty: querySnapshot.empty,
                    size: querySnapshot.size,
                    metadata: querySnapshot.metadata
                });

                // Handle empty collection
                if (querySnapshot.empty) {
                    console.log('No products found in collection');
                    container.innerHTML = `
                        <div class="empty-message">
                            ‚úß No timepieces available at the moment.<br>
                            <span style="font-size: 0.9rem; color: #555; margin-top: 1rem; display: block;">
                                Please check back later or contact our concierge.
                            </span>
                        </div>
                    `;
                    
                    // Show debug info
                    debugInfo.style.display = 'block';
                    debugInfo.innerHTML = `
                        <strong>Debug Information:</strong><br>
                        Collection "products" exists but is empty.<br>
                        Please add documents to the "products" collection in Firestore.<br>
                        Expected document structure:<br>
                        {
                            name: "Watch Name" (string),
                            price: 5000 (number),
                            description: "..." (string),
                            image: "image-url" (string),
                            stock: 5 (number)
                        }
                    `;
                    return;
                }

                // Build HTML for products
                let html = '';
                let productCount = 0;
                
                querySnapshot.forEach((docSnap) => {
                    const productId = docSnap.id;
                    const productData = docSnap.data();
                    
                    console.log('Processing product:', productId, productData);
                    
                    // Validate required fields
                    if (!productData.name || !productData.price) {
                        console.warn('Product missing required fields:', productId, productData);
                        return; // Skip invalid products
                    }
                    
                    productCount++;
                    
                    // Handle image URL with fallback
                    const imageUrl = productData.image || 'https://placehold.co/600x600/c6a75e/0f0f0f?text=Zenithra';
                    
                    html += `
                        <a href="product.html?id=${productId}" class="product-card">
                            <img 
                                src="${imageUrl}" 
                                alt="${productData.name}" 
                                loading="lazy"
                                onerror="this.src='https://placehold.co/600x600/c6a75e/0f0f0f?text=Zenithra'"
                            >
                            <div class="product-name">${productData.name}</div>
                            <div class="product-price">CHF ${Number(productData.price).toLocaleString()}</div>
                        </a>
                    `;
                });

                console.log(`Successfully loaded ${productCount} products`);

                if (productCount === 0) {
                    container.innerHTML = `
                        <div class="empty-message">
                            No valid products found. Please check product data structure.
                        </div>
                    `;
                    return;
                }

                container.innerHTML = html;

            } catch (error) {
                console.error('Error loading products:', error);
                
                // Detailed error message
                let errorDetails = 'Unknown error';
                if (error.code) {
                    errorDetails = `Error code: ${error.code}\nMessage: ${error.message}`;
                } else {
                    errorDetails = error.message || String(error);
                }
                
                container.innerHTML = `
                    <div class="error-message">
                        <span style="font-size: 1.2rem; display: block; margin-bottom: 1rem;">‚ö†Ô∏è</span>
                        Products temporarily unavailable.<br>
                        <span style="font-size: 0.9rem; color: #999; margin-top: 1rem; display: block;">
                            Our team has been notified. Please try again later.
                        </span>
                    </div>
                `;
                
                // Show debug info with specific error
                debugInfo.style.display = 'block';
                debugInfo.innerHTML = `
                    <strong>Debug Information:</strong><br>
                    Error loading from Firestore:<br>
                    ${errorDetails.replace(/\n/g, '<br>')}<br><br>
                    <strong>Troubleshooting:</strong><br>
                    1. Verify Firestore rules allow reading from "products" collection<br>
                    2. Check if collection name is exactly "products" (case sensitive)<br>
                    3. Ensure documents have required fields: name, price, description, image, stock<br>
                    4. Check Firebase console for authentication/authorization
                `;
            }
        }

        // Load products when page loads
        loadProducts();
    </script>
</body>
</html>
